%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ロボット制御基礎論P68[2.15]の演習問題  %
% 2020/10/1                            %
% 答え一致                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

syms lc ld le lb lf lg

px=lc+le;
py=lb-ld;
pz=-lf;
R13=0;
R23=0;
R33=-1;

%　ヤコビ行列の縦成分
jv1 = [-py-R23*lg;px+R13*lg;0;0;0;1];
jv2 = [pz+R33*lg;0;-lc-le;0;1;0];
jv3 = [-lf+R33*lg;0;-le;0;1;0];
jv4 = [0;0;0;0;0;-1];
jv5 = [-1;0;0;0;1;0];
jv6 = [0;0;0;R13;R23;R33];

J = [jv1 jv2 jv3 jv4 jv5 jv6]; %ヤコビ行列
J = J.'; %ヤコビ行列の転置 
t = [0;0;100;10;0;0]; %力f=[0;0;100]トルクτ=[10;0;0]
T = J*t;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ロボット工学の基礎P71例題4.7           %
% 2020/10/1                            %
% 答え一致                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
syms l1 l2 l3

nH = [0;0;0.5];
fH = [1;2;0];
l1 = 0.2;
l2 = 0.2;
l3 = 0.2;
th1 = pi/6;
th2 = pi/6;
th3 = pi/6;

t0 = [cos(th1) -sin(th1) 0 0;sin(th1) cos(th1) 0 0;0 0 1 0;0 0 0 1];
t1 = [cos(th2) -sin(th2) 0 l1;sin(th2) cos(th2) 0 0;0 0 1 0;0 0 0 1];
t2 = [1 0 0 l1;0 1 0 0;0 0 1 0;0 0 0 1];
t3 = t0*t1*t1*t2; % T0H
t4 = t1*t2; %T1H
t5 = t1;%T2H

%Σ0からΣH
R0H = [0 -1 0;1 0 0;0 0 1];
p0H = [l1/2 + (3^(1/2)*l1)/2;(3*l1)/2 + (3^(1/2)*l1)/2;0];
p0Ht = [0 0 (3*l1)/2 + (3^(1/2)*l1)/2;0 0 -(l1/2 + (3^(1/2)*l1)/2);-((3*l1)/2 + (3^(1/2)*l1)/2) l1/2 + (3^(1/2)*l1)/2  0]; %外積の形に変換
n0 = R0H*nH+(p0Ht*R0H)*fH;
n0 = norm(n0);

%Σ1からΣH
R1H = [3^(1/2)/2 -1/2 0;1/2 3^(1/2)/2 0;0 0 1]; 
p1H = [0.3732;0.1;0];
p1Ht = [0 0 0.1;0 0 -0.3732;-0.1 0.3732 0]; %外積の形に変換
n1 = R1H*nH+(p1Ht*R1H)*fH;
n1 = norm(n1);

%Σ2からΣH
R2H = [0.8660 -0.5 0;0.5 0.8660 0;0 0 1];
p2H = [l3;0;0];
p2Ht = [0 0 0;0 0 -l3;0 l3 0];
n2 = R2H*nH+(p2Ht*R2H)*fH; %外積の形に変換
n2 = norm(n2);

T = [n0 n1 n2] % 各関節のトルク
